{% extends 'fic_benchmark/base.html' %}
{% load static %}
{% load humanize %}
{% load l10n %}

{% block title %}Comparación de estadisticas{% endblock %}
{% block container %}

<script>
    let values = JSON.parse('{{ values|safe|escapejs }}');
    let comparedValues = JSON.parse('{{ compared_values|safe|escapejs }}');
    let selectedFundName = "{{ selected_fund.name|escapejs }}";
    let comparedFundName = "{{ compared_fund.name|escapejs }}";
    let stats = JSON.parse('{{ filtered_stats_json|safe|escapejs }}');
    console.log("Type stats: " + typeof stats);
    console.log("stats: " + stats);
    console.log("stats: " + stats.profitability_avg);
    console.log("stats: " + stats.unit_value_avg);
</script>

<h2>Estadisticas de los fondos de inversion</h2>
<p>Por favor, seleccione una de las siguientes opciones:</p>
<form method="GET">
    <label for="fund_id">Fondo:</label>
    <select name="fund_id" id="fund_id">
        {% for fund in funds %}
            <option value="{{ fund.id }}">{{ fund.name }}</option>
        {% endfor %}
    </select><br>
    <label for="compare_fund_id">Fondo a comparar:</label>
    <select name="compare_fund_id" id="compare_fund_id">
        <!-- option value="">No comparar</option -->
        {% for fund in funds %}
            <option value="{{ fund.id }}">{{ fund.name }}</option>
        {% endfor %}
    </select><br>
    <button type="submit">Filtrar</button><hr>

</form>
<section>
    <details>
        <summary>Tablas de {{ selected_fund.name }} - Riesgo: <b>{{selected_fund.get_risk_level_display}}</b> Calificación: <b>{{selected_fund.get_rating_display}}</b></summary>
        <table>
            <tr>
                <th>Periodo</th>
                <th>Valor del fondo en Millones</th>
                <th>Unidades en circulación</th>
                <th>Valor de la unidad</th>
                <th>Inversionistas</th>
                <th>Rentabilidad E.A.</th>
                <th>Volatilidad</th>
            </tr>
            {% for statistic in filtered_statistics %}
                <tr>
                    <td class="text-right">{{ statistic.period|date:"M Y" }}</td>
                    <td class="text-right">$ {{ statistic.value_fund|localize }}</td>
                    <td class="text-right">{{ statistic.units_in_circulation|intcomma }}</td>
                    <td class="text-right">$ {{ statistic.unit_value|localize }}</td>
                    <td class="text-right">{{ statistic.investors|intcomma }}</td>
                    <td class="{% if statistic.profitability < 0 %}negative-text-right{% else %}text-right{% endif %}">{{ statistic.profitability }} %</td>
                    <td class="text-right">{{ statistic.volatility }} %</td>
                </tr>
            {% endfor %}
        </table>
        {{ filtered_statistics.count }} resultados
        <table>
            <tr>
                <th>Dato</th>
                <th>Mínimo</th>
                <th>Media</th>
                <th>Máximo</th>
                <th>Desviación std</th>
                <th>Varianza</th>
                <th>Sumatoria</th>
            </tr>
            <tr>
                <td class="text-right"><b>Valor del fondo: </b></td>
                <td class="text-right">{{ filtered_stats.value_fund_min|intcomma }}</td>
                <td class="text-right">{{ filtered_stats.value_fund_avg|intcomma }}</td>
                <td class="text-right">{{ filtered_stats.value_fund_max|intcomma }}</td>
                <td class="text-right">{{ filtered_stats.value_fund_stddev|intcomma }}</td>
                <td class="text-right">{{ filtered_stats.value_fund_variance|intcomma }}</td>
                <td class="text-right">{{ filtered_stats.value_fund_sum|intcomma }}</td>
            </tr>
            <tr>
                <td class="text-right"><b>Unidades en circulación: </b></td>
                <td class="text-right">{{ filtered_stats.units_in_circulation_min|intcomma }}</td>
                <td class="text-right">{{ filtered_stats.units_in_circulation_avg|intcomma }}</td>
                <td class="text-right">{{ filtered_stats.units_in_circulation_max|intcomma }}</td>
                <td class="text-right">{{ filtered_stats.units_in_circulation_stddev|intcomma }}</td>
                <td class="text-right">{{ filtered_stats.units_in_circulation_variance|intcomma }}</td>
                <td class="text-right">{{ filtered_stats.units_in_circulation_sum|intcomma }}</td>
            </tr>
            <tr>
                <td class="text-right"><b>Valor de la unidad: </b></td>
                <td class="text-right">{{ filtered_stats.unit_value_min|intcomma }}</td>
                <td class="text-right">{{ filtered_stats.unit_value_avg|intcomma }}</td>
                <td class="text-right">{{ filtered_stats.unit_value_max|intcomma }}</td>
                <td class="text-right">{{ filtered_stats.unit_value_stddev|intcomma }}</td>
                <td class="text-right">{{ filtered_stats.unit_value_variance|intcomma }}</td>
                <td class="text-right">{{ filtered_stats.unit_value_sum|intcomma }}</td>
            </tr>
            <tr>
                <td class="text-right"><b>Inversionistas: </b></td>
                <td class="text-right">{{ filtered_stats.investors_min|intcomma }}</td>
                <td class="text-right">{{ filtered_stats.investors_avg|intcomma }}</td>
                <td class="text-right">{{ filtered_stats.investors_max|intcomma }}</td>
                <td class="text-right">{{ filtered_stats.investors_stddev|intcomma }}</td>
                <td class="text-right">{{ filtered_stats.investors_variance|intcomma }}</td>
                <td class="text-right">{{ filtered_stats.investors_sum|intcomma }}</td>
            </tr>
            <tr>
                <td class="text-right"><b>Rentabilidad: </b></td>
                <td class="text-right">{{ filtered_stats.profitability_min|intcomma }}</td>
                <td class="text-right">{{ filtered_stats.profitability_avg|intcomma }}</td>
                <td class="text-right">{{ filtered_stats.profitability_max|intcomma }}</td>
                <td class="text-right">{{ filtered_stats.profitability_stddev|intcomma }}</td>
                <td class="text-right">{{ filtered_stats.profitability_variance|intcomma }}</td>
                <td class="text-right">{{ filtered_stats.profitability_sum|intcomma }}</td>
            </tr>
            <tr>
                <td class="text-right"><b>Volatilidad: </b></td>
                <td class="text-right">{{ filtered_stats.volatility_min|intcomma }}</td>
                <td class="text-right">{{ filtered_stats.volatility_avg|intcomma }}</td>
                <td class="text-right">{{ filtered_stats.volatility_max|intcomma }}</td>
                <td class="text-right">{{ filtered_stats.volatility_stddev|intcomma }}</td>
                <td class="text-right">{{ filtered_stats.volatility_variance|intcomma }}</td>
                <td class="text-right">{{ filtered_stats.volatility_sum|intcomma }}</td>
            </tr>
        </table>
        
    </details>
</section>

<section>
    <details>
        <summary>Tablas de {{ compared_fund.name }} - Riesgo: <b>{{compared_fund_fund.get_risk_level_display}}</b> Calificación: <b>{{compared_fund.get_rating_display}}</b></summary>
        <table>
            <tr>
                <th>Periodo</th>
                <th>Valor del fondo en Millones</th>
                <th>Unidades en circulación</th>
                <th>Valor de la unidad</th>
                <th>Inversionistas</th>
                <th>Rentabilidad E.A.</th>
                <th>Volatilidad</th>
            </tr>
            {% for statistic in compared_filtered_statistics %}
                <tr>
                    <td class="text-right">{{ statistic.period|date:"M Y" }}</td>
                    <td class="text-right">$ {{ statistic.value_fund|intcomma|localize }}</td>
                    <td class="text-right">{{ statistic.units_in_circulation|intcomma }}</td>
                    <td class="text-right">$ {{ statistic.unit_value|intcomma|localize }}</td>
                    <td class="text-right">{{ statistic.investors|intcomma }}</td>
                    <td class="{% if statistic.profitability < 0 %}negative-text-right{% else %}text-right{% endif %}">{{ statistic.profitability }} %</td>
                    <td class="text-right">{{ statistic.volatility }} %</td>
                </tr>
            {% endfor %}
        </table>
        {{ compared_filtered_statistics.count }} resultados
        <table id="descriptive_stats_compared">
            <tr>
                <th>Dato</th>
                <th>Mínimo</th>
                <th>Media</th>
                <th>Máximo</th>
                <th>Desviación std</th>
                <th>Varianza</th>
                <th>Sumatoria</th>
            </tr>
            <tr>
                <td class="text-right"><b>Valor del fondo: </b></td>
                <td class="text-right">{{ compared_stats.value_fund_min|intcomma }}</td>
                <td class="text-right">{{ compared_stats.value_fund_avg|intcomma }}</td>
                <td class="text-right">{{ compared_stats.value_fund_max|intcomma }}</td>
                <td class="text-right">{{ compared_stats.value_fund_stddev|intcomma }}</td>
                <td class="text-right">{{ compared_stats.value_fund_variance|intcomma }}</td>
                <td class="text-right">{{ compared_stats.value_fund_sum|intcomma }}</td>
            </tr>
            <tr>
                <td class="text-right"><b>Unidades en circulación: </b></td>
                <td class="text-right">{{ compared_stats.units_in_circulation_min|intcomma }}</td>
                <td class="text-right">{{ compared_stats.units_in_circulation_avg|intcomma }}</td>
                <td class="text-right">{{ compared_stats.units_in_circulation_max|intcomma }}</td>
                <td class="text-right">{{ compared_stats.units_in_circulation_stddev|intcomma }}</td>
                <td class="text-right">{{ compared_stats.units_in_circulation_variance|intcomma }}</td>
                <td class="text-right">{{ compared_stats.units_in_circulation_sum|intcomma }}</td>
            </tr>
            <tr>
                <td class="text-right"><b>Valor de la unidad: </b></td>
                <td class="text-right">{{ compared_stats.unit_value_min|intcomma }}</td>
                <td class="text-right">{{ compared_stats.unit_value_avg|intcomma }}</td>
                <td class="text-right">{{ compared_stats.unit_value_max|intcomma }}</td>
                <td class="text-right">{{ compared_stats.unit_value_stddev|intcomma }}</td>
                <td class="text-right">{{ compared_stats.unit_value_variance|intcomma }}</td>
                <td class="text-right">{{ compared_stats.unit_value_sum|intcomma }}</td>
            </tr>
            <tr>
                <td class="text-right"><b>Inversionistas: </b></td>
                <td class="text-right">{{ compared_stats.investors_min|intcomma }}</td>
                <td class="text-right">{{ compared_stats.investors_avg|intcomma }}</td>
                <td class="text-right">{{ compared_stats.investors_max|intcomma }}</td>
                <td class="text-right">{{ compared_stats.investors_stddev|intcomma }}</td>
                <td class="text-right">{{ compared_stats.investors_variance|intcomma }}</td>
                <td class="text-right">{{ compared_stats.investors_sum|intcomma }}</td>
            </tr>
            <tr>
                <td class="text-right"><b>Rentabilidad: </b></td>
                <td class="text-right">{{ compared_stats.profitability_min|intcomma }}</td>
                <td class="text-right">{{ compared_stats.profitability_avg|intcomma }}</td>
                <td class="text-right">{{ compared_stats.profitability_max|intcomma }}</td>
                <td class="text-right">{{ compared_stats.profitability_stddev|intcomma }}</td>
                <td class="text-right">{{ compared_stats.profitability_variance|intcomma }}</td>
                <td class="text-right">{{ compared_stats.profitability_sum|intcomma }}</td>
            </tr>
            <tr>
                <td class="text-right"><b>Volatilidad: </b></td>
                <td class="text-right">{{ compared_stats.volatility_min|intcomma }}</td>
                <td class="text-right">{{ compared_stats.volatility_avg|intcomma }}</td>
                <td class="text-right">{{ compared_stats.volatility_max|intcomma }}</td>
                <td class="text-right">{{ compared_stats.volatility_stddev|intcomma }}</td>
                <td class="text-right">{{ compared_stats.volatility_variance|intcomma }}</td>
                <td class="text-right">{{ compared_stats.volatility_sum|intcomma }}</td>
            </tr>
        </table>
    </details>
</section>

<h4>Gráfica de {{selected_fund.name}} vs {{compared_fund.name}}</h4>

<canvas id="comparative_value_funds" width="400" height="200"></canvas>
<canvas id="comparative_units_in_circulation" width="400" height="200"></canvas>
<canvas id="comparative_investors" width="400" height="200"></canvas>
<canvas id="comparative_unit_values" width="400" height="200"></canvas>
<canvas id="comparative_profitability" width="400" height="200"></canvas>
<canvas id="comparative_volatility" width="400" height="200"></canvas>
<canvas id="comparative_units_per_capita" width="400" height="200"></canvas>
<canvas id="comparative_unit_value_per_capita" width="400" height="200"></canvas>
<canvas id="comparative_teorical_value_fund" width="400" height="200"></canvas>
<canvas id="comparative_profitability_diff_inflation" width="400" height="200"></canvas>
<canvas id="comparative_unit_values_diff_inflation" width="400" height="200"></canvas>

{% endblock %}
{% block extra_js %}
<script src="{% static 'fic_benchmark/all_chart.js' %}"></script>
{% endblock %}
  