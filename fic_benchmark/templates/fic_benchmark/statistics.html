{% extends 'fic_benchmark/base.html' %}
{% load static %}
{% load humanize %}
{% load l10n %}

{% block title %}Comparación de estadisticas{% endblock %}
{% block container %}
<h2>Estadisticas de los fondos de inversion</h2>
<p>Por favor, seleccione una de las siguientes opciones:</p>
<form method="GET">
    <label for="fund_id">Fondo:</label>
    <select name="fund_id" id="fund_id">
        {% for fund in funds %}
            <option value="{{ fund.id }}">{{ fund.name }}</option>
        {% endfor %}
    </select><br>
    <label for="compare_fund_id">Fondo a comparar:</label>
    <select name="compare_fund_id" id="compare_fund_id">
        <!-- option value="">No comparar</option -->
        {% for fund in funds %}
            <option value="{{ fund.id }}">{{ fund.name }}</option>
        {% endfor %}
    </select><br>
    <button type="submit">Filtrar</button><hr>

</form>
<section>
    <details>
        <summary>Tablas de {{ selected_fund.name }} - Riesgo: <b>{{selected_fund.get_risk_level_display}}</b> Calificación: <b>{{selected_fund.get_rating_display}}</b></summary>
        <table>
            <tr>
                <th>Periodo</th>
                <th>Valor del fondo</th>
                <th>Unidades en circulación</th>
                <th>Valor de la unidad</th>
                <th>Inversionistas</th>
                <th>Rentabilidad</th>
                <th>Volatilidad</th>
            </tr>
            {% for statistic in filtered_statistics %}
                <tr>
                    <td class="text-right">{{ statistic.period|date:"M Y" }}</td>
                    <td class="text-right">$ {{ statistic.value_fund|localize }}</td>
                    <td class="text-right">{{ statistic.units_in_circulation|intcomma }}</td>
                    <td class="text-right">$ {{ statistic.unit_value|localize }}</td>
                    <td class="text-right">{{ statistic.investors|intcomma }}</td>
                    <td class="{% if statistic.profitability < 0 %}negative-text-right{% else %}text-right{% endif %}">{{ statistic.profitability }} %</td>
                    <td class="text-right">{{ statistic.volatility }} %</td>
                </tr>
            {% endfor %}
        </table>
    </details>
</section>

<section>
    <details>
        <summary>Tablas de {{ compared_fund.name }} - Riesgo: <b>{{compared_fund_fund.get_risk_level_display}}</b> Calificación: <b>{{compared_fund.get_rating_display}}</b></summary>
        <table>
            <tr>
                <th>Periodo</th>
                <th>Valor del fondo</th>
                <th>Unidades en circulación</th>
                <th>Valor de la unidad</th>
                <th>Inversionistas</th>
                <th>Rentabilidad</th>
                <th>Volatilidad</th>
            </tr>
            {% for statistic in compared_filtered_statistics %}
                <tr>
                    <td class="text-right">{{ statistic.period|date:"M Y" }}</td>
                    <td class="text-right">$ {{ statistic.value_fund|intcomma|localize }}</td>
                    <td class="text-right">{{ statistic.units_in_circulation|intcomma }}</td>
                    <td class="text-right">$ {{ statistic.unit_value|intcomma|localize }}</td>
                    <td class="text-right">{{ statistic.investors|intcomma }}</td>
                    <td class="{% if statistic.profitability < 0 %}negative-text-right{% else %}text-right{% endif %}">{{ statistic.profitability }} %</td>
                    <td class="text-right">{{ statistic.volatility }} %</td>
                </tr>
            {% endfor %}
        </table>
        {{ compared_filtered_statistics.count }} resultados
        {{ compared_filtered_statistics.descriptive_unit_value.mean }} statistics
    </details>
</section>
    
<h4>Gráfica de {{selected_fund.name}} vs {{compared_fund.name}}</h4>

<script>
    let values = JSON.parse('{{ values|safe|escapejs }}');
    let comparedValues = JSON.parse('{{ compared_values|safe|escapejs }}');
    let selectedFundName = "{{ selected_fund.name|escapejs }}";
    let comparedFundName = "{{ compared_fund.name|escapejs }}";
</script>
<canvas id="comparative_value_funds" width="400" height="200"></canvas>
<canvas id="comparative_units_in_circulation" width="400" height="200"></canvas>
<canvas id="comparative_investors" width="400" height="200"></canvas>
<canvas id="comparative_unit_values" width="400" height="200"></canvas>
<canvas id="comparative_profitability" width="400" height="200"></canvas>
<canvas id="comparative_volatility" width="400" height="200"></canvas>

<!-- Para borrar luego: -->
<script>
    console.log("Median Unit Value: ", comparedValues.descriptive_unit_value.median);
</script>
{% endblock %}
{% block extra_js %}
<script src="{% static 'fic_benchmark/all_chart.js' %}"></script>
{% endblock %}
  